# Configuração do Apache Virtual Host para Controle de Estoque
# Arquivo: /etc/apache2/sites-available/controle-estoque.conf

# Configuração para rodar em localhost/estoque
# Não precisa de VirtualHost separado, apenas aliases

# Configuração WSGI para aplicação em subdiretório
WSGIDaemonProcess controle_estoque python-path=/var/www/controle_estoque_db python-home=/var/www/controle_estoque_db/venv
WSGIScriptAlias /estoque /var/www/controle_estoque_db/wsgi.py
# Configuração de diretórios para aplicação em subdiretório
<Directory /var/www/controle_estoque_db>
    WSGIProcessGroup controle_estoque
    WSGIApplicationGroup %{GLOBAL}
    Require all granted
    Options -Indexes
</Directory>

# Servir arquivos estáticos em /estoque/static
Alias /estoque/static /var/www/controle_estoque_db/static
<Directory /var/www/controle_estoque_db/static>
    Require all granted
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
    Options -Indexes
</Directory>

# Alias para downloads de relatórios em /estoque/relatorios
Alias /estoque/relatorios /var/www/controle_estoque_db/relatorios
<Directory /var/www/controle_estoque_db/relatorios>
    Require all granted
    Options -Indexes
</Directory>

# Configurações específicas para a aplicação /estoque
<Location /estoque>
    # Headers de segurança
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options SAMEORIGIN
    Header always set X-XSS-Protection "1; mode=block"
    
    # Logs específicos (se suportado)
    # ErrorLog ${APACHE_LOG_DIR}/controle_estoque_error.log
    # CustomLog ${APACHE_LOG_DIR}/controle_estoque_access.log combined
</Location>

# Compressão gzip para aplicação /estoque
<Location /estoque>
    SetOutputFilter DEFLATE
    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ no-gzip dont-vary
    SetEnvIfNoCase Request_URI \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
</Location>

# Cache para arquivos estáticos da aplicação
<LocationMatch "^/estoque/static/.*\.(css|js|png|jpg|jpeg|gif|ico|svg)$">
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
    Header append Cache-Control "public"
</LocationMatch>

# Para HTTPS, a mesma configuração funciona automaticamente
# pois usa caminhos relativos (WSGIScriptAlias /estoque)
# Não precisa de configuração adicional para SSL